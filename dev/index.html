<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Image Plugin Test - All Options | EditorJS</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f8f9fa;
    }

    .demo-header {
      background: white;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .demo-header h1 {
      margin: 0 0 10px 0;
      color: #2c3e50;
      font-size: 24px;
    }

    .demo-header p {
      margin: 0;
      color: #7f8c8d;
    }

    #editorjs {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      min-height: 400px;
    }

    .feature-info {
      background: #e8f5e8;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #27ae60;
    }

    .feature-info h3 {
      margin: 0 0 10px 0;
      color: #27ae60;
    }

    .feature-info ul {
      margin: 0;
      padding-left: 20px;
    }
  </style>
</head>

<body>
  <div class="demo-header">
    <h1>üñºÔ∏è EditorJS Image Tool - Enhanced Features Demo</h1>
    <p>Test all image tool capabilities including captions, links, size presets, alignment options, and styling
      features!</p>
  </div>

  <div id="editorjs"></div>

  <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script>
  <script type="module">
    import ImageTool from "../src/index.ts";

    const editor = new EditorJS({
      holder: "editorjs",
      placeholder: "Click here to start editing and test all image features...",
      data: {
        time: Date.now(),
        blocks: [
          {
            id: "demo-text-1",
            type: "paragraph",
            data: {
              text: "üé® <b>Enhanced Image Tool Demo</b> - Click on the image below to access the settings menu and test all the new features including size presets, alignment options, caption toggle, link functionality, and styling controls."
            }
          },
          {
            id: "demo-image-1",
            type: "image",
            data: {
              file: {
                url: "https://images.unsplash.com/photo-1607604276583-eef5d076aa5f?q=80&w=800&auto=format&fit=crop"
              }
            }
          },
          {
            id: "demo-text-2",
            type: "paragraph",
            data: {
              text: "üÜï <b>Add More Images</b> - Use the + button in the toolbar to add new image blocks. Upload files, paste URLs, or drag and drop images directly to test all features!"
            }
          }
        ]
      },

      tools: {
        image: {
          class: ImageTool,
          config: {
            // Test both endpoint and custom uploader approaches
            endpoints: {
              byFile: "http://localhost:8008/uploadFile",
              byUrl: "http://localhost:8008/fetchUrl"
            },

            // Field name for file uploads
            field: "image",

            // Allowed file types
            types: "image/*",

            // Test custom uploader (uncomment the lines below to test custom uploader instead of endpoints)
            /*
            uploader: {
              async uploadByFile(file) {
                console.log('Custom uploadByFile called with:', file);
                // Simulate getting image dimensions
                const getImageSize = (file) => {
                  return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => resolve({ width: img.width, height: img.height });
                    img.src = URL.createObjectURL(file);
                  });
                };
                
                const { width, height } = await getImageSize(file);
                // Simulate upload delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                return {
                  success: 1,
                  file: {
                    url: "https://images.unsplash.com/photo-1607604276583-eef5d076aa5f?q=80&w=800&auto=format&fit=crop",
                    width,
                    height,
                    customProperty: "test-value"
                  }
                };
              },
              async uploadByUrl(url) {
                console.log('Custom uploadByUrl called with:', url);
                return {
                  success: 1,
                  file: {
                    url: url,
                    customProperty: "url-upload"
                  }
                };
              }
            }
            */
          }
        }
      },

      // Additional EditorJS configuration for better demo experience
      autofocus: true,
      onReady: () => {
        console.log('Editor.js is ready to work!');
      },

      onChange: (api, event) => {
        console.log('Content changed:', event);
      }
    });

    // Add some helpful console commands for testing
    window.editor = editor;
    window.getImageData = async () => {
      const data = await editor.save();
      const imageBlocks = data.blocks.filter(block => block.type === 'image');
      console.table(imageBlocks.map(block => ({
        caption: block.data.caption,
        linkUrl: block.data.linkUrl,
        withBorder: block.data.withBorder,
        withBackground: block.data.withBackground,
        size: block.data.size,
        alignment: block.data.alignment,
        url: block.data.file.url.substring(0, 50) + '...'
      })));
      return imageBlocks;
    };

    console.log('üõ†Ô∏è Enhanced Demo Helper Commands:');
    console.log('- window.editor: Access editor instance');
    console.log('- window.getImageData(): View all image block data with new fields in table format');
  </script>
</body>

</html>